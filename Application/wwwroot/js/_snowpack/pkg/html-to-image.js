function U(){throw new Error("setTimeout has not been defined")}function M(){throw new Error("clearTimeout has not been defined")}var m=U,g=M,b;typeof window!="undefined"?b=window:typeof self!="undefined"?b=self:b={},typeof b.setTimeout=="function"&&(m=setTimeout),typeof b.clearTimeout=="function"&&(g=clearTimeout);function V(e){if(m===setTimeout)return setTimeout(e,0);if((m===U||!m)&&setTimeout)return m=setTimeout,setTimeout(e,0);try{return m(e,0)}catch(t){try{return m.call(null,e,0)}catch(n){return m.call(this,e,0)}}}function ne(e){if(g===clearTimeout)return clearTimeout(e);if((g===M||!g)&&clearTimeout)return g=clearTimeout,clearTimeout(e);try{return g(e)}catch(t){try{return g.call(null,e)}catch(n){return g.call(this,e)}}}var d=[],x=!1,w,P=-1;function re(){!x||!w||(x=!1,w.length?d=w.concat(d):P=-1,d.length&&H())}function H(){if(!x){var e=V(re);x=!0;for(var t=d.length;t;){for(w=d,d=[];++P<t;)w&&w[P].run();P=-1,t=d.length}w=null,x=!1,ne(e)}}function ie(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];d.push(new B(e,t)),d.length===1&&!x&&V(H)}function B(e,t){this.fun=e,this.array=t}B.prototype.run=function(){this.fun.apply(null,this.array)};var oe="browser",ce="browser",ue=!0,se=[],fe="",ae={},le={},he={};function v(){}var de=v,me=v,ge=v,pe=v,we=v,ve=v,ye=v;function be(e){throw new Error("process.binding is not supported")}function xe(){return"/"}function Se(e){throw new Error("process.chdir is not supported")}function Te(){return 0}var S=b.performance||{},Ee=S.now||S.mozNow||S.msNow||S.oNow||S.webkitNow||function(){return new Date().getTime()};function Ce(e){var t=Ee.call(S)*.001,n=Math.floor(t),r=Math.floor(t%1*1e9);return e&&(n=n-e[0],r=r-e[1],r<0&&(n--,r+=1e9)),[n,r]}var Pe=new Date;function Re(){var e=new Date,t=e-Pe;return t/1e3}var $e={nextTick:ie,title:oe,browser:ue,env:{NODE_ENV:"production"},argv:se,version:fe,versions:ae,on:de,addListener:me,once:ge,off:pe,removeListener:we,removeAllListeners:ve,emit:ye,binding:be,cwd:xe,chdir:Se,umask:Te,hrtime:Ce,platform:ce,release:le,config:he,uptime:Re},O=function(e,t,n,r){function i(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function f(u){try{s(r.next(u))}catch(l){c(l)}}function a(u){try{s(r.throw(u))}catch(l){c(l)}}function s(u){u.done?o(u.value):i(u.value).then(f,a)}s((r=r.apply(e,t||[])).next())})};const W="application/font-woff",j="image/jpeg",_e={woff:W,woff2:W,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:j,jpeg:j,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"};function Le(e){const t=/\.([^./]*?)$/g.exec(e);return t?t[1]:""}function R(e){const t=Le(e).toLowerCase();return _e[t]||""}function Ie(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i))return e;const n=document.implementation.createHTMLDocument(),r=n.createElement("base"),i=n.createElement("a");return n.head.appendChild(r),n.body.appendChild(i),t&&(r.href=t),i.href=e,i.href}function I(e){return e.search(/^(data:)/)!==-1}function $(e,t){return`data:${t};base64,${e}`}function Ae(e){return e.split(/,/)[1]}const De=function(){let t=0;const n=()=>`0000${(Math.random()*Math.pow(36,4)<<0).toString(36)}`.slice(-4);return()=>(t+=1,`u${n()}${t}`)}();function p(e){const t=[];for(let n=0,r=e.length;n<r;n+=1)t.push(e[n]);return t}function _(e,t){const n=window.getComputedStyle(e).getPropertyValue(t);return parseFloat(n.replace("px",""))}function ke(e){const t=_(e,"border-left-width"),n=_(e,"border-right-width");return e.clientWidth+t+n}function Fe(e){const t=_(e,"border-top-width"),n=_(e,"border-bottom-width");return e.clientHeight+t+n}function Ue(){let e,t;try{t=$e}catch(r){}const n=t&&t.env?t.env.devicePixelRatio:null;return n&&(e=parseInt(n,10),Number.isNaN(e)&&(e=1)),e||window.devicePixelRatio||1}function Me(e){return e.toBlob?new Promise(t=>e.toBlob(t)):new Promise(t=>{const n=window.atob(e.toDataURL().split(",")[1]),r=n.length,i=new Uint8Array(r);for(let o=0;o<r;o+=1)i[o]=n.charCodeAt(o);t(new Blob([i],{type:"image/png"}))})}function A(e){return new Promise((t,n)=>{const r=new Image;r.onload=()=>t(r),r.onerror=n,r.crossOrigin="anonymous",r.decoding="sync",r.src=e})}function Ve(e){return O(this,void 0,void 0,function*(){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(e)).then(encodeURIComponent).then(t=>`data:image/svg+xml;charset=utf-8,${t}`)})}function He(e,t,n){return O(this,void 0,void 0,function*(){const r="http://www.w3.org/2000/svg",i=document.createElementNS(r,"svg"),o=document.createElementNS(r,"foreignObject");return i.setAttribute("width",`${t}`),i.setAttribute("height",`${n}`),i.setAttribute("viewBox",`0 0 ${t} ${n}`),o.setAttribute("width","100%"),o.setAttribute("height","100%"),o.setAttribute("x","0"),o.setAttribute("y","0"),o.setAttribute("externalResourcesRequired","true"),i.appendChild(o),o.appendChild(e),Ve(i)})}const D={};function Be(e){let t=e.replace(/\?.*/,"");return/ttf|otf|eot|woff2?/i.test(t)&&(t=t.replace(/.*\//,"")),t}function k(e,t){const n=Be(e);if(D[n]!=null)return D[n];t.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+new Date().getTime());const r=o=>{let c="";if(t.imagePlaceholder){const a=t.imagePlaceholder.split(/,/);a&&a[1]&&(c=a[1])}let f=`Failed to fetch resource: ${e}`;return o&&(f=typeof o=="string"?o:o.message),f&&console.error(f),{blob:c,contentType:""}},i=window.fetch(e).then(o=>o.blob().then(c=>({blob:c,contentType:o.headers.get("Content-Type")||""}))).then(({blob:o,contentType:c})=>new Promise((f,a)=>{const s=new FileReader;s.onloadend=()=>f({contentType:c,blob:s.result}),s.onerror=a,s.readAsDataURL(o)})).then(({blob:o,contentType:c})=>({contentType:c,blob:Ae(o)})).catch(r);return D[n]=i,i}function Oe(e){const t=e.getPropertyValue("content");return`${e.cssText} content: '${t.replace(/'|"/g,"")}';`}function We(e){return p(e).map(t=>{const n=e.getPropertyValue(t),r=e.getPropertyPriority(t);return`${t}: ${n}${r?" !important":""};`}).join(" ")}function je(e,t,n){const r=`.${e}:${t}`,i=n.cssText?Oe(n):We(n);return document.createTextNode(`${r}{${i}}`)}function z(e,t,n){const r=window.getComputedStyle(e,n),i=r.getPropertyValue("content");if(i===""||i==="none")return;const o=De();try{t.className=`${t.className} ${o}`}catch(f){return}const c=document.createElement("style");c.appendChild(je(o,n,r)),t.appendChild(c)}function ze(e,t){z(e,t,":before"),z(e,t,":after")}var T=function(e,t,n,r){function i(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function f(u){try{s(r.next(u))}catch(l){c(l)}}function a(u){try{s(r.throw(u))}catch(l){c(l)}}function s(u){u.done?o(u.value):i(u.value).then(f,a)}s((r=r.apply(e,t||[])).next())})};function qe(e){return T(this,void 0,void 0,function*(){const t=e.toDataURL();return t==="data:,"?Promise.resolve(e.cloneNode(!1)):A(t)})}function Ge(e,t){return T(this,void 0,void 0,function*(){return Promise.resolve(e.poster).then(n=>k(n,t)).then(n=>$(n.blob,R(e.poster)||n.contentType)).then(n=>A(n))})}function Xe(e,t){return T(this,void 0,void 0,function*(){return e instanceof HTMLCanvasElement?qe(e):e instanceof HTMLVideoElement&&e.poster?Ge(e,t):Promise.resolve(e.cloneNode(!1))})}const Je=e=>e.tagName!=null&&e.tagName.toUpperCase()==="SLOT";function Ke(e,t,n){var r;return T(this,void 0,void 0,function*(){const i=Je(e)&&e.assignedNodes?p(e.assignedNodes()):p(((r=e.shadowRoot)!==null&&r!==void 0?r:e).childNodes);return i.length===0||e instanceof HTMLVideoElement?Promise.resolve(t):i.reduce((o,c)=>o.then(()=>q(c,n)).then(f=>{f&&t.appendChild(f)}),Promise.resolve()).then(()=>t)})}function Qe(e,t){const n=window.getComputedStyle(e),r=t.style;!r||(n.cssText?r.cssText=n.cssText:p(n).forEach(i=>{r.setProperty(i,n.getPropertyValue(i),n.getPropertyPriority(i))}))}function Ye(e,t){e instanceof HTMLTextAreaElement&&(t.innerHTML=e.value),e instanceof HTMLInputElement&&t.setAttribute("value",e.value)}function Ze(e,t){return T(this,void 0,void 0,function*(){return t instanceof Element?Promise.resolve().then(()=>Qe(e,t)).then(()=>ze(e,t)).then(()=>Ye(e,t)).then(()=>t):Promise.resolve(t)})}function q(e,t,n){return T(this,void 0,void 0,function*(){return!n&&t.filter&&!t.filter(e)?Promise.resolve(null):Promise.resolve(e).then(r=>Xe(r,t)).then(r=>Ke(e,r,t)).then(r=>Ze(e,r))})}var Ne=function(e,t,n,r){function i(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function f(u){try{s(r.next(u))}catch(l){c(l)}}function a(u){try{s(r.throw(u))}catch(l){c(l)}}function s(u){u.done?o(u.value):i(u.value).then(f,a)}s((r=r.apply(e,t||[])).next())})};const G=/url\((['"]?)([^'"]+?)\1\)/g,et=/url\([^)]+\)\s*format\((["'])([^"']+)\1\)/g,tt=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function nt(e){const t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${t})(['"]?\\))`,"g")}function rt(e){const t=[];return e.replace(G,(n,r,i)=>(t.push(i),n)),t.filter(n=>!I(n))}function it(e,t,n,r,i){const o=n?Ie(t,n):t;return Promise.resolve(o).then(c=>i?i(c):k(c,r)).then(c=>typeof c=="string"?$(c,R(t)):$(c.blob,R(t)||c.contentType)).then(c=>e.replace(nt(t),`$1${c}$3`)).then(c=>c,()=>o)}function ot(e,{preferredFontFormat:t}){return t?e.replace(tt,n=>{for(;;){const[r,,i]=et.exec(n)||[];if(!i)return"";if(i===t)return`src: ${r};`}}):e}function X(e){return e.search(G)!==-1}function J(e,t,n){return Ne(this,void 0,void 0,function*(){if(!X(e))return Promise.resolve(e);const r=ot(e,n);return Promise.resolve(r).then(rt).then(i=>i.reduce((o,c)=>o.then(f=>it(f,c,t,n)),Promise.resolve(r)))})}var L=function(e,t,n,r){function i(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function f(u){try{s(r.next(u))}catch(l){c(l)}}function a(u){try{s(r.throw(u))}catch(l){c(l)}}function s(u){u.done?o(u.value):i(u.value).then(f,a)}s((r=r.apply(e,t||[])).next())})};function ct(e,t){var n;return L(this,void 0,void 0,function*(){const r=(n=e.style)===null||n===void 0?void 0:n.getPropertyValue("background");return r?Promise.resolve(r).then(i=>J(i,null,t)).then(i=>(e.style.setProperty("background",i,e.style.getPropertyPriority("background")),e)):Promise.resolve(e)})}function ut(e,t){return L(this,void 0,void 0,function*(){if(!(e instanceof HTMLImageElement&&!I(e.src))&&!(e instanceof SVGImageElement&&!I(e.href.baseVal)))return Promise.resolve(e);const n=e instanceof HTMLImageElement?e.src:e.href.baseVal;return Promise.resolve(n).then(r=>k(r,t)).then(r=>$(r.blob,R(n)||r.contentType)).then(r=>new Promise((i,o)=>{e.onload=i,e.onerror=o,e instanceof HTMLImageElement?(e.srcset="",e.src=r):e.href.baseVal=r})).then(()=>e,()=>e)})}function st(e,t){return L(this,void 0,void 0,function*(){const r=p(e.childNodes).map(i=>K(i,t));return Promise.all(r).then(()=>e)})}function K(e,t){return L(this,void 0,void 0,function*(){return e instanceof Element?Promise.resolve(e).then(n=>ct(n,t)).then(n=>ut(n,t)).then(n=>st(n,t)):Promise.resolve(e)})}function ft(e,t){const{style:n}=e;t.backgroundColor&&(n.backgroundColor=t.backgroundColor),t.width&&(n.width=`${t.width}px`),t.height&&(n.height=`${t.height}px`);const r=t.style;return r!=null&&Object.keys(r).forEach(i=>{n[i]=r[i]}),e}var E=function(e,t,n,r){function i(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function f(u){try{s(r.next(u))}catch(l){c(l)}}function a(u){try{s(r.throw(u))}catch(l){c(l)}}function s(u){u.done?o(u.value):i(u.value).then(f,a)}s((r=r.apply(e,t||[])).next())})};const Q={};function Y(e){const t=Q[e];if(t!=null)return t;const n=window.fetch(e).then(r=>({url:e,cssText:r.text()}));return Q[e]=n,n}function Z(e){return E(this,void 0,void 0,function*(){return e.cssText.then(t=>{let n=t;const r=/url\(["']?([^"')]+)["']?\)/g,o=(n.match(/url\([^)]+\)/g)||[]).map(c=>{let f=c.replace(r,"$1");return f.startsWith("https://")||(f=new URL(f,e.url).href),window.fetch(f).then(a=>a.blob()).then(a=>new Promise((s,u)=>{const l=new FileReader;l.onloadend=()=>{n=n.replace(c,`url(${l.result})`),s([c,l.result])},l.onerror=u,l.readAsDataURL(a)}))});return Promise.all(o).then(()=>n)})})}function N(e){if(e==null)return[];const t=[],n=/(\/\*[\s\S]*?\*\/)/gi;let r=e.replace(n,"");const i=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const a=i.exec(r);if(a===null)break;t.push(a[0])}r=r.replace(i,"");const o=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,c="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",f=new RegExp(c,"gi");for(;;){let a=o.exec(r);if(a===null){if(a=f.exec(r),a===null)break;o.lastIndex=f.lastIndex}else f.lastIndex=o.lastIndex;t.push(a[0])}return t}function at(e){return E(this,void 0,void 0,function*(){const t=[],n=[];return e.forEach(r=>{if("cssRules"in r)try{p(r.cssRules).forEach((i,o)=>{if(i.type===CSSRule.IMPORT_RULE){let c=o+1;const f=i.href,a=Y(f).then(s=>s?Z(s):"").then(s=>N(s).forEach(u=>{try{r.insertRule(u,u.startsWith("@import")?c+=1:r.cssRules.length)}catch(l){console.error("Error inserting rule from remote css",{rule:u,error:l})}})).catch(s=>{console.error("Error loading remote css",s.toString())});n.push(a)}})}catch(i){const o=e.find(c=>c.href==null)||document.styleSheets[0];r.href!=null&&n.push(Y(r.href).then(c=>c?Z(c):"").then(c=>N(c).forEach(f=>{o.insertRule(f,r.cssRules.length)})).catch(c=>{console.error("Error loading remote stylesheet",c.toString())})),console.error("Error inlining remote css file",i.toString())}}),Promise.all(n).then(()=>(e.forEach(r=>{if("cssRules"in r)try{p(r.cssRules).forEach(i=>{t.push(i)})}catch(i){console.error(`Error while reading CSS rules from ${r.href}`,i.toString())}}),t))})}function lt(e){return e.filter(t=>t.type===CSSRule.FONT_FACE_RULE).filter(t=>X(t.style.getPropertyValue("src")))}function ht(e){return E(this,void 0,void 0,function*(){return new Promise((t,n)=>{e.ownerDocument==null&&n(new Error("Provided element is not within a Document")),t(p(e.ownerDocument.styleSheets))}).then(t=>at(t)).then(lt)})}function ee(e,t){return E(this,void 0,void 0,function*(){return ht(e).then(n=>Promise.all(n.map(r=>{const i=r.parentStyleSheet?r.parentStyleSheet.href:null;return J(r.cssText,i,t)}))).then(n=>n.join(`
`))})}function dt(e,t){return E(this,void 0,void 0,function*(){return(t.fontEmbedCSS!=null?Promise.resolve(t.fontEmbedCSS):ee(e,t)).then(n=>{const r=document.createElement("style"),i=document.createTextNode(n);return r.appendChild(i),e.firstChild?e.insertBefore(r,e.firstChild):e.appendChild(r),e})})}var y=function(e,t,n,r){function i(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function f(u){try{s(r.next(u))}catch(l){c(l)}}function a(u){try{s(r.throw(u))}catch(l){c(l)}}function s(u){u.done?o(u.value):i(u.value).then(f,a)}s((r=r.apply(e,t||[])).next())})};function F(e,t={}){const n=t.width||ke(e),r=t.height||Fe(e);return{width:n,height:r}}function te(e,t={}){return y(this,void 0,void 0,function*(){const{width:n,height:r}=F(e,t);return Promise.resolve(e).then(i=>q(i,t,!0)).then(i=>dt(i,t)).then(i=>K(i,t)).then(i=>ft(i,t)).then(i=>He(i,n,r))})}const h=16384;function mt(e){(e.width>h||e.height>h)&&(e.width>h&&e.height>h?e.width>e.height?(e.height*=h/e.width,e.width=h):(e.width*=h/e.height,e.height=h):e.width>h?(e.height*=h/e.width,e.width=h):(e.width*=h/e.height,e.height=h))}function C(e,t={}){return y(this,void 0,void 0,function*(){return te(e,t).then(A).then(n=>{const r=document.createElement("canvas"),i=r.getContext("2d"),o=t.pixelRatio||Ue(),{width:c,height:f}=F(e,t),a=t.canvasWidth||c,s=t.canvasHeight||f;return r.width=a*o,r.height=s*o,t.skipAutoScale||mt(r),r.style.width=`${a}`,r.style.height=`${s}`,t.backgroundColor&&(i.fillStyle=t.backgroundColor,i.fillRect(0,0,r.width,r.height)),i.drawImage(n,0,0,r.width,r.height),r})})}function gt(e,t={}){return y(this,void 0,void 0,function*(){const{width:n,height:r}=F(e,t);return C(e,t).then(i=>i.getContext("2d").getImageData(0,0,n,r).data)})}function pt(e,t={}){return y(this,void 0,void 0,function*(){return C(e,t).then(n=>n.toDataURL())})}function wt(e,t={}){return y(this,void 0,void 0,function*(){return C(e,t).then(n=>n.toDataURL("image/jpeg",t.quality||1))})}function vt(e,t={}){return y(this,void 0,void 0,function*(){return C(e,t).then(Me)})}function yt(e,t={}){return y(this,void 0,void 0,function*(){return ee(e,t)})}export{yt as getFontEmbedCSS,vt as toBlob,C as toCanvas,wt as toJpeg,gt as toPixelData,pt as toPng,te as toSvg};
